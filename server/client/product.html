<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品頁面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-2xl mx-auto p-4 bg-white shadow-md rounded-lg mt-10">
        <h1 id="productName" class="text-3xl font-bold mb-4">商品名稱</h1>
        <p id="productDescription" class="text-gray-600 mb-4">商品描述</p>
        <p id="productPrice" class="text-xl font-semibold mb-4">價格: $0</p>
        
        <div class="mb-4">
            <label for="productOption" class="block mb-2">選項：</label>
            <select id="productOption" class="w-full p-2 border rounded">
                <!-- 選項將由 JavaScript 動態填充 -->
            </select>
        </div>
        
        <div class="mb-4">
            <label for="quantity" class="block mb-2">數量：</label>
            <input 
                type="number" 
                id="quantity" 
                value="1" 
                min="1"
                class="w-full p-2 border rounded"
            />
        </div>
        
        <button 
            id="addToCartBtn"
            class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"
        >
            加入購物車
        </button>
        
        <p id="message" class="mt-4 text-center text-green-600"></p>
    </div>

    <script>
        // 假設這是從API獲取的商品信息
        const product = {
            id: 1,
            name: '範例商品',
            price: 100,
            description: '這是一個範例商品描述。',
            options: ['紅色', '藍色', '綠色']
        };

        // 填充商品信息
        document.getElementById('productName').textContent = product.name;
        document.getElementById('productDescription').textContent = product.description;
        document.getElementById('productPrice').textContent = `價格: $${product.price}`;

        // 填充選項
        const optionSelect = document.getElementById('productOption');
        product.options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            optionSelect.appendChild(optionElement);
        });

        // 處理加入購物車
        document.getElementById('addToCartBtn').addEventListener('click', async () => {
            const quantity = parseInt(document.getElementById('quantity').value);
            const selectedOption = optionSelect.value;
            const messageElement = document.getElementById('message');

            try {
                const response = await axios({
                    method: 'post',
                    url: 'http://localhost:3000/riverflow/cart/add',  // 更新的 API 端點
                    data: {
                        productId: product.id,
                        quantity: quantity,
                        productName: product.name,
                        productOpt: selectedOption,
                        price: product.price
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.data.success) {
                    messageElement.textContent = '商品已成功加入購物車！';
                    messageElement.className = 'mt-4 text-center text-green-600';
                } else {
                    messageElement.textContent = '加入購物車失敗，請稍後再試。';
                    messageElement.className = 'mt-4 text-center text-red-600';
                }
            } catch (error) {
                console.error('Error adding to cart:', error);
                messageElement.textContent = `加入購物車時發生錯誤: ${error.response ? error.response.status : '未知錯誤'}`;
                messageElement.className = 'mt-4 text-center text-red-600';
            }
        });

        // 確保數量始終為正整數
        document.getElementById('quantity').addEventListener('change', (e) => {
            e.target.value = Math.max(1, parseInt(e.target.value) || 1);
        });
    </script>
</body>
</html>